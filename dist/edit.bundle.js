(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{1027:function(e,t,n){"use strict";n.r(t);var a=n(129),r=n.n(a),c=n(4),i=n.n(c),o=n(5),l=n.n(o),s=n(6),u=n.n(s),m=n(7),h=n.n(m),f=n(29),d=n.n(f),p=n(8),b=n.n(p),g=n(27),v=n.n(g),y=n(0),E=n.n(y),D=n(639),O=n(638),j=n(642),S=n(644),k=n(653),N=n(902),w=n(85),x=n(99),P=n.n(x),C=n(652),T=n(16),F=n(185),I=n(87),B=n.n(I),U=n(888),_=n.n(U),X=n(188),G=n(893),A=n(98);function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(Object(n),!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var q=function(e){function t(e){var n;return i()(this,t),n=u()(this,h()(t).call(this,e)),v()(d()(n),"fetchingData",(function(){return C.a.getRegistrationEventById(n.props.match.params.eventID).then((function(e){return R({},e,{year:j.a.find((function(t){return t.value===Object(T.d)(e.year)})),semester:S.a.find((function(t){return t.value===e.semester})),studentGroup:k.a.find((function(t){return t.value===e.studentGroup}))})}))})),v()(d()(n),"handleUpdateRegistrationEvent",(function(e){n.setState({loading:!0});var t=R({},e.getData()),a=r()(t.childEvents);t.childEvents=a.map((function(e){return e.delay?e.delay=e.delay.toString():e=P()(e,"delay"),e=P()(e,["id","status"])})),C.a.updateRegistrationEvent(n.props.match.params.eventID,{data:R({},t,{year:Object(T.e)(t.year.value),semester:t.semester.value,studentGroup:t.studentGroup.value}),oldEvents:n.state.draft.childEvents.map((function(e){return e.delay?e.delay=e.delay.toString():e=P()(e,"delay"),e=P()(e,["id","status"])}))}).then((function(e){n.setState({draft:R({},e,{childEvents:e.childEvents.map((function(e){return R({},e,{id:_()()})})),year:j.a.find((function(t){return t.value===Object(T.d)(e.year)})),semester:S.a.find((function(t){return t.value===e.semester})),studentGroup:k.a.find((function(t){return t.value===e.studentGroup}))}),loading:!1})})).catch((function(e){return n.setState({loading:!1,error:e.message})}))})),v()(d()(n),"handleDelete",(function(){return X.b.confirm({title:"Xác nhận",text:"Bạn muôn xóa đợt đăng ký này?",btnText:"Đồng ý",cancelText:"Hủy bỏ"}).then((function(e){if(e)return C.a.deleteRegistrationEvent(n.props.match.params.eventID,{events:n.state.draft.childEvents.map((function(e){return e.delay?e.delay=e.delay.toString():e=P()(e,"delay"),e=P()(e,["id","status"])}))}).then((function(e){A.b.publish({"common-popup":E.a.createElement("div",{className:"common-success-notify"},"Xóa đợt đăng ký học kì ",e.semester+1," nhóm ",e.studentGroup," năm học ",e.year.from," - ",e.year.to," thành công")}),w.b.push("/manage/registration-events")}))}))})),n.state={loading:!1,error:null,draft:{},fetching:!0},n.fetchingData().then((function(e){n.setState({draft:R({},e,{childEvents:e.childEvents.map((function(e){return R({},e,{id:_()()})}))}),fetching:!1})})),n}return b()(t,e),l()(t,[{key:"render",value:function(){var e=this;return E.a.createElement(O.a,{title:"Cập nhật đợt đăng ký học"},E.a.createElement(D.a,{title:"Cập nhật đợt đăng ký học"},E.a.createElement("div",{className:"registration-event-edit-route"},E.a.createElement(G.a,{statistics:[{label:"Sinh viên tham gia",value:this.state.draft.childEvents?this.state.draft.childEvents.reduce((function(e,t){return e+t.appliedStudents.length}),0):0,icon:E.a.createElement("i",{class:"fad fa-users"}),style:"info"},{label:"Đợt nhỏ",value:this.state.draft.childEvents?this.state.draft.childEvents.length:0,icon:E.a.createElement("i",{className:"fab fa-elementor"}),style:"danger"}]}),E.a.createElement("div",{className:"common-route-wrapper"},this.state.fetching&&E.a.createElement(F.a,{className:"edit-form-loading"}),E.a.createElement("div",{className:"route-body"},E.a.createElement(N.a,{disabledSelect:this.state.draft.isActive,isEdit:!0,onFormChange:function(t){e.state.error&&e.setState({error:""})},initData:R({},this.state.draft),serverError:this.state.error,renderActions:function(t,n){var a=R({},t.getData());console.log(e.state.draft),console.log(a),console.log(B()(R({},e.state.draft),a));var r=!(t.getInvalidPaths().length||e.state.error||e.state.loading||B()(R({},e.state.draft),a)||n);return E.a.createElement(E.a.Fragment,null,E.a.createElement("button",{className:"btn btn-cancel",onClick:function(){return w.b.push("/manage/registration-events")}},"Trở về"),E.a.createElement("button",{className:"btn btn-back",onClick:e.handleDelete},"Xóa bỏ"),E.a.createElement("button",{className:"btn btn-next",onClick:function(){return e.handleUpdateRegistrationEvent(t)},disabled:!r},"Cập nhật",e.state.loading&&E.a.createElement(F.a,null)))}}))))))}}]),t}(E.a.Component);t.default=q},1030:function(e,t,n){"use strict";n.r(t);var a=n(4),r=n.n(a),c=n(5),i=n.n(c),o=n(6),l=n.n(o),s=n(7),u=n.n(s),m=n(29),h=n.n(m),f=n(8),d=n.n(f),p=n(27),b=n.n(p),g=n(0),v=n.n(g),y=n(638),E=n(639),D=n(189),O=n(670),j=(n(663),n(99)),S=n.n(j),k=n(904),N=n(646),w=n(894),x=n(185),P=n(187),C=n(895),T=n(294),F=n(896),I=n(85),B=n(87),U=n.n(B),_=n(188),X=n(98);function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach((function(t){b()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var H=function(e){function t(e){var n;r()(this,t),n=l()(this,u()(t).call(this,e)),b()(h()(n),"fetchingData",(function(){return D.a.getUserDetails(n.props.match.params.accountID).then((function(e){return e}))})),b()(h()(n),"detailFormComponent",{pdt:function(){return v.a.createElement(C.a,{form:n.infoForm,isEdit:!0})},admin:function(){return v.a.createElement(C.a,{form:n.infoForm,isEdit:!0})},gv:function(){return v.a.createElement(T.a,{form:n.infoForm,isEdit:!0})},sv:function(){return v.a.createElement(F.a,{form:n.infoForm,isEdit:!0})}}),b()(h()(n),"tabs",[{label:"Thông tin tài khoản",render:function(){return v.a.createElement(k.a,{form:n.accountBasicForm,isEdit:!0})}},{label:"Thông tin chi tiết",render:function(){return n.detailFormComponent[n.state.draft.role]()},isDisabled:function(){return!n.infoForm}}]),b()(h()(n),"getServerError",(function(e){var t={duplicate_identityID:function(){return"Mã định danh ".concat(e.extra.value," đã tồn tại")},duplicate_email:function(){return"Email ".concat(e.extra.value," đã tồn tại")},duplicate_phone:function(){return"Số điện thoại ".concat(e.extra.value," đã tồn tại")},duplicate_username:function(){return"Tên đăng nhập ".concat(e.extra.value," đã tồn tại")}};return t.hasOwnProperty(e.message)?t[e.message]():"Đã có lỗi xảy ra."})),b()(h()(n),"handleUpdateAccount",(function(e){console.log(e),n.setState({loading:!0}),D.a.updateUserInfo(e._id,S()(e,"_id")).then((function(e){n.setState({loading:!1,draft:A({},e)}),n.accountBasicForm.updateData(S()(e,"info")),n.infoForm&&n.infoForm.updateData(A({},e.info)),X.b.publish({"common-popup":v.a.createElement("div",{className:"common-success-notify"},"Cập nhật thành công")})})).catch((function(e){n.setState({loading:!1}),console.log("dasd"),_.b.alert({title:"Cập nhật thất bại",text:n.getServerError(e),btnText:"Ok",style:"danger"})}))})),b()(h()(n),"deleteAccount",(function(e){return _.b.confirm({title:"Xác nhận",text:"Bạn muôn xóa tài khoản này?",btnText:"Đồng ý",cancelText:"Hủy bỏ"}).then((function(t){t&&(n.setState({deleting:!0}),D.a.deleteAccount(e).then((function(e){I.b.push("/manage/accounts"),X.b.publish({"common-popup":v.a.createElement("div",{className:"common-success-notify"},"Xóa tài khoản ",e.username," thành công")})})))}))})),n.state={loading:!1,error:null,draft:{},fetching:!0,deleting:!1};var a=Object(w.a)("account");return n.fetchingData().then((function(e){var t=new Date(e.dob);t.setSeconds(0),t.setMilliseconds(0),e.dob=t.toISOString(),n.accountBasicForm=Object(N.a)(a.schema,{initData:A({},a.getInitData(),{},S()(e,"info"))}),n.infoForm=null;var r=Object(w.a)(e.role);r&&(n.infoForm=Object(N.a)(r.schema,{initData:A({},r.getInitData(),{},e.info)}),n.onUnmount(n.infoForm.on("change",(function(e){n.state.error&&n.setState({error:""}),n.forceUpdate()})))),n.onUnmount(n.accountBasicForm.on("change",(function(e){n.state.error&&n.setState({error:""}),n.forceUpdate()}))),n.setState({draft:A({},e),fetching:!1})})),n}return d()(t,e),i()(t,[{key:"render",value:function(){var e=this,t=this.state,n=t.fetching,a=t.draft,r=t.error,c=t.loading,i=t.deleting,o=null;this.accountBasicForm&&(o=A({},this.accountBasicForm.getData())),this.infoForm&&(o.info=A({},this.infoForm.getData())),console.log(o);var l=!(n||i||c||this.accountBasicForm.getInvalidPaths().length||r||c||U()(this.infoForm?a:S()(a,["info"]),o)||this.infoForm&&this.infoForm.getInvalidPaths().length);return v.a.createElement(y.a,{title:"Cập nhật người dùng"},v.a.createElement(E.a,{title:"Cập nhật người dùng"},v.a.createElement("div",{className:"account-edit-route account-route"},v.a.createElement("div",{className:"common-route-wrapper"},n?v.a.createElement(x.a,null):v.a.createElement(O.a,{tabs:this.tabs,initIndex:0}),v.a.createElement("div",{className:"account-route-action"},v.a.createElement("button",{className:"btn btn-cancel",onClick:function(){return I.b.push("/manage/accounts")}},"Hủy bỏ"),v.a.createElement("button",{className:"btn btn-danger",onClick:function(){return e.deleteAccount(o._id)},disabled:i},"Xóa",i&&v.a.createElement(x.a,null)),v.a.createElement("button",{className:"btn btn-next",onClick:function(){return e.handleUpdateAccount(o)},disabled:!l},"Cập nhật",c&&v.a.createElement(x.a,null)))))))}}]),t}(P.a);t.default=H},1039:function(e,t,n){"use strict";n.r(t);var a=n(181),r=n.n(a),c=n(4),i=n.n(c),o=n(5),l=n.n(o),s=n(6),u=n.n(s),m=n(7),h=n.n(m),f=n(29),d=n.n(f),p=n(8),b=n.n(p),g=n(27),v=n.n(g),y=n(0),E=n.n(y),D=n(638),O=n(639),j=(n(189),n(670)),S=(n(663),n(99),n(646)),k=n(899),N=n(185),w=n(187),x=n(85),P=n(87),C=n.n(P),T=n(188),F=(n(643),n(98)),I=n(72),B=n(900),U=n(903),_=n(686),X=n(901);function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var H=function(e){function t(e){var n;return i()(this,t),n=u()(this,h()(t).call(this,e)),v()(d()(n),"fetchingData",(function(){return Promise.all([_.a.getSubjectDetail(n.props.match.params.subjectID),I.b.get().then((function(e){return[{label:"Chọn bộ môn",value:""}].concat(e.map((function(e){return{label:e.name,value:e._id}})))}))])})),v()(d()(n),"tabs",[{label:"Thông tin môn học",render:function(){return E.a.createElement(B.a,{form:n.form,isEdit:!0,divisions:n.state.divisions})}},{label:"Cài đặt lớp học phần",render:function(){return E.a.createElement(U.a,{form:n.form,isEdit:!0})}}]),v()(d()(n),"getServerError",(function(e){var t={duplicate_subjectID:function(){return"Mã môn ".concat(e.extra.subjectID," (").concat(e.extra.name,") đã tồn tại")},un_deletable_classes:function(){return E.a.createElement("div",{className:"err-reason"},E.a.createElement("div",{className:"err-section"},E.a.createElement("p",{className:"err-title"},"Lớp học phần nằm trong TKB toàn trường"),E.a.createElement(X.a,{className:"err-table",list:e.extra,columns:[{label:"STT",cellDisplay:function(e,t){return t+1}},{label:"Tên lớp",cellDisplay:function(e){return e.class.name}},{label:"Thứ",cellDisplay:function(e){return e.dayOfWeek+1}},{label:"Ca",cellDisplay:function(e){return e.from.name+"-"+e.to.name}},{label:"Phòng học",cellDisplay:function(e){return e.classRoom.name}},{label:"Giảng viên",cellDisplay:function(e){return e.instructor.user?e.instructor.user.name+"(".concat(e.instructor.user.identityID,")"):"Unknown"}}],rowTrackBy:function(e,t){return e._id}})))}};return t.hasOwnProperty(e.message)?t[e.message]():"Đã có lỗi xảy ra."})),v()(d()(n),"handleUpdateSubject",(function(){n.setState({loading:!0});var e=n.form.getData();_.a.updateSubject(e._id,e).then((function(e){var t=A({},e,{division:e.division||n.state.divisions[0].value});n.setState({draft:A({},t),loading:!1}),F.b.publish({"common-popup":E.a.createElement("div",{className:"common-success-notify"},"Cập nhật thành công")}),n.form.updateData(A({},t))})).catch((function(e){console.log("dsa"),n.setState({loading:!1}),T.b.alert({title:"Cập nhật thất bại",text:n.getServerError(e),btnText:"Ok",style:"danger"}).then((function(){n.refreshData()}))}))})),v()(d()(n),"deleteSubject",(function(){var e=n.props.match.params.subjectID;return T.b.confirm({title:"Xác nhận",text:E.a.createElement("div",{className:"alert-confirm"},E.a.createElement("p",{className:"alert-title"},"Bạn có muốn xóa học phần này? Học phần sẽ chỉ bị xóa nếu:"),E.a.createElement("div",{className:"prerequisites"},E.a.createElement("p",null,"- Không có lớp học phần nào thuộc thời khóa biểu toàn trường"),E.a.createElement("p",null,"- Học phần không thuộc chương trình học nào"),E.a.createElement("p",null,"- Không có lớp học phần nào đã được đăng ký trước đó (Kết quả đã nằm trong bảng điểm của sinh viên)")),E.a.createElement("p",{className:"alert-sub"},"Các lớp và nhóm lớp học phần liên quan sẽ bị xóa khi xóa học phần này. Các học phần khác có điều kiện tiên quyết bao gồm học phần này sẽ không còn hiệu lực.")),btnText:"Đồng ý",cancelText:"Hủy bỏ"}).then((function(t){t&&(n.setState({deleting:!0}),_.a.deleteSubject(e).then((function(e){x.b.push("/manage/subjects"),F.b.publish({"common-popup":E.a.createElement("div",{className:"common-success-notify"},"Xóa học phần ",e.name,"(",e.subjectID,") thành công")})})).catch((function(e){var t=e.extra,a=t.items,r=t.programs,c=t.results;n.setState({deleting:!1}),T.b.alert({title:"Xóa học phần thất bại",text:E.a.createElement("div",{className:"err-reason"},!!a.length&&E.a.createElement("div",{className:"err-section"},E.a.createElement("p",{className:"err-title"},"Thời khóa biểu toàn trường"),E.a.createElement(X.a,{className:"err-table",list:a,columns:[{label:"STT",cellDisplay:function(e,t){return t+1}},{label:"Tên lớp",cellDisplay:function(e){return e.class.name}},{label:"Thứ",cellDisplay:function(e){return e.dayOfWeek+1}},{label:"Ca",cellDisplay:function(e){return e.from.name+"-"+e.to.name}},{label:"Phòng học",cellDisplay:function(e){return e.classRoom.name}},{label:"Giảng viên",cellDisplay:function(e){return e.instructor.user?e.instructor.user.name+"(".concat(e.instructor.user.identityID,")"):"Unknown"}}],rowTrackBy:function(e,t){return e._id}})),!!r.length&&E.a.createElement("div",{className:"err-section"},E.a.createElement("p",{className:"err-title"},"Chương trình học"),E.a.createElement(X.a,{className:"err-table",list:r,columns:[{label:"STT",cellDisplay:function(e,t){return t+1}},{label:"Tên chuyên ngành",cellDisplay:function(e){return e.speciality.name}}],rowTrackBy:function(e,t){return e._id}})),!!c.length&&E.a.createElement("div",{className:"err-section"},E.a.createElement("p",{className:"err-title"},"Bảng điểm"),E.a.createElement(X.a,{className:"err-table",list:c,columns:[{label:"STT",cellDisplay:function(e,t){return t+1}},{label:"Sinh viên",cellDisplay:function(e){return e.owner.user?e.owner.user.name+"(".concat(e.owner.user.identityID,")"):"Unknown"}},{label:"Tên chuyên ngành",cellDisplay:function(e){return e.speciality.name}}],rowTrackBy:function(e,t){return e._id}}))),btnText:"Ok",style:"danger"})})))}))})),v()(d()(n),"refreshData",(function(){n.form.updateData(A({},n.state.draft))})),n.state={loading:!1,error:null,draft:{},fetching:!0,deleting:!1,divisions:[]},n.fetchingData().then((function(e){var t=r()(e,2),a=t[0],c=t[1];n.form=Object(S.a)(k.a,{initData:A({},a,{division:a.division||c[0].value})}),n.onUnmount(n.form.on("change",(function(e){n.state.error&&n.setState({error:""}),n.forceUpdate()}))),n.form.validateData(),n.setState({draft:A({},a,{division:a.division||c[0].value}),fetching:!1,divisions:c})})),n}return b()(t,e),l()(t,[{key:"render",value:function(){var e=this.state,t=e.fetching,n=e.draft,a=e.error,r=e.loading,c=e.deleting,i=!(t||c||r||this.form.getInvalidPaths().length||a||C()(n,this.form.getData()));return this.form&&(console.log(C()(n,this.form.getData())),console.log(this.form.getData()),console.log(this.form.getInvalidPaths()),console.log(this.form.getErrorPath(this.form.getInvalidPaths()[0]))),E.a.createElement(D.a,{title:"Cập nhật môn học"},E.a.createElement(O.a,{title:"Cập nhật môn học"},E.a.createElement("div",{className:"account-edit-route account-route"},E.a.createElement("div",{className:"common-route-wrapper"},t?E.a.createElement(N.a,null):E.a.createElement(j.a,{tabs:this.tabs,initIndex:0}),E.a.createElement("div",{className:"account-route-action"},E.a.createElement("button",{className:"btn btn-refresh",onClick:this.refreshData,disabled:!this.form||C()(n,this.form.getData())},E.a.createElement("i",{className:"far fa-sync-alt"})),E.a.createElement("button",{className:"btn btn-cancel",onClick:function(){return x.b.push("/manage/subjects")}},"Hủy bỏ"),E.a.createElement("button",{className:"btn btn-danger",onClick:this.deleteSubject,disabled:c},"Xóa",c&&E.a.createElement(N.a,null)),E.a.createElement("button",{className:"btn btn-next",onClick:this.handleUpdateSubject,disabled:!i},"Cập nhật",r&&E.a.createElement(N.a,null)))))))}}]),t}(w.a);t.default=H}}]);