(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{1048:function(e,t,n){"use strict";n.r(t);var r=n(4),a=n.n(r),i=n(5),c=n.n(i),s=n(6),o=n.n(s),u=n(7),l=n.n(u),d=n(29),f=n.n(d),m=n(8),g=n.n(m),p=n(27),h=n.n(p),b=n(0),S=n.n(b),v=n(638),y=n(187),k=n(639),E=n(135),j=n(185),O=n(905),w=n(124),N=n.n(w),D=n(712),_=n(18),L=n(687),P=n(713),C=n(72),I=n(644),x=n(642),R=n(16),F=n(255),T=n.n(F),B=n(87),W=n.n(B),Y=n(186),A=(n(23),n(714),n(898)),G=n(652),K=n(188),J=n(715);function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function V(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(Object(n),!0).forEach((function(t){h()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var q=function(e){function t(e){var n;return a()(this,t),n=o()(this,l()(t).call(this,e)),h()(f()(n),"updateSubjectLessons",(function(e,t){for(var r=n.state.subjectList,a=0;a<r.length;a++){if(r[a]._id===e._id)return r[a].lessons=t,n.setState({subjectList:r})}})),h()(f()(n),"toggleRegister",(function(e){var t=C.a.syncGet(),r=t.currentYear,a=t.currentSemester,i=n.state.subjectList.find((function(t){return t.lessons.find((function(t){return t.find((function(t){return t._id===e[0]._id}))}))}));return P.a.toggleRegisterLesson(n.state.pickedStudent.info._id,"".concat(r.from,"-").concat(r.to),a,{lesson:e}).then((function(){return Promise.all([n.board.loadData(),G.a.getSubjectInfo(i.lessons,"".concat(r.from,"-").concat(r.to),a).then((function(e){n.updateSubjectLessons(i,e),n.setState({loading:!1})})).catch((function(e){n.setState({error:e,loading:!1})}))])})).catch((function(e){if("full"===e.message)return K.b.alert({text:S.a.createElement(J.a,{strongText:"Thông báo:",type:"border",color:"danger",content:S.a.createElement(S.a.Fragment,null,S.a.createElement("span",{className:"pl-3"},"Bạn không thể đăng ký ",S.a.createElement("strong",null,e.extra.name)," do lớp đã đầy"))}),title:"Lỗi đăng ký",btnText:"Đồng ý"})}))})),h()(f()(n),"onRegister",(function(e){var t=n.state,r=t.schedule,a=t.pickedSubject,i=t.subjectList;if(!r)return n.toggleRegister(e);var c=i.find((function(e){return e._id===a})).lessons.reduce((function(e,t){return e.concat(t.map((function(e){return e._id})))}),[]),s=r.list.map((function(e){return e._id})),o=null;return s.find((function(e){return!!c.includes(e)}))||!r.list.find((function(t){return!!e.find((function(e){return!(e.dayOfWeek!==t.dayOfWeek||e.from.name>t.to.name||e.to.name<t.from.name)&&(o={newItem:e,existed:t},!0)}))}))?n.toggleRegister(e):(console.log(o),K.b.alert({text:S.a.createElement(J.a,{strongText:"Thông báo:",type:"border",color:"danger",content:S.a.createElement(S.a.Fragment,null,S.a.createElement("span",{className:"pl-3"},"Bạn không thể đăng ký ",S.a.createElement("strong",null,o.newItem.name)," do trùng vào ",S.a.createElement("strong",null,o.existed.dayOfWeek<7?"Thứ "+(o.existed.dayOfWeek+1):"Chủ nhật")," ",S.a.createElement("strong",null,"Ca ",o.existed.from.name,"-",o.existed.to.name)," của ",S.a.createElement("strong",null,o.existed.class.name)))}),title:"Lỗi đăng ký",btnText:"Đồng ý"}))})),h()(f()(n),"loadData",(function(){return G.a.getSubjectListForForceRegistration(n.state.pickedStudent)})),h()(f()(n),"onClickScheduleItem",(function(e,t){var r=t.setLoading,a=_.a.getState().info;if(console.log(a.division),console.log(e),a.division?e.class.subject.division===a.division._id:"pdt"===_.a.getState().role){r();var i=!0,c=!1,s=void 0;try{for(var o,u=n.state.subjectList[Symbol.iterator]();!(i=(o=u.next()).done);i=!0){var l=o.value.lessons.find((function(t){return!!t.find((function(t){return t._id===e._id}))}));if(l)return n.toggleRegister(l)}}catch(e){c=!0,s=e}finally{try{i||null==u.return||u.return()}finally{if(c)throw s}}}})),h()(f()(n),"refreshScheduleBoard",T()((function(e){n.setState({pickedStudent:e.pickedStudents[0],pickedStudents:e.pickedStudents},(function(){n.board.loadData()}))}),1500)),h()(f()(n),"displayInsScheduleItem",(function(e){return S.a.createElement("div",{className:"common-inner-task"},S.a.createElement("div",{className:"class-name"},e.class.name),S.a.createElement("div",{className:"class-room-name"},e.classRoom.name))})),n.state={loading:!0,pickedStudent:e.pickedStudents[0],pickedStudents:e.pickedStudents,pickedSubject:null,schedule:null,list:[],subjectList:[]},n.loadData().then((function(e){n.setState(V({},e,{loading:!1}))})).catch((function(e){n.setState({error:e,loading:!1})})),n}return g()(t,e),c()(t,[{key:"componentWillReceiveProps",value:function(e){W()(e.pickedStudents,this.props.pickedStudents)||this.refreshScheduleBoard(e)}},{key:"render",value:function(){var e=this,t=this.state,n=t.pickedStudent,r=t.pickedStudents,a=t.pickedSubject,i=t.subjectList,c=t.loading,s=i.find((function(e){return e._id===a})),o=C.a.syncGet(),u=o.currentYear,l=o.currentSemester;console.log(n);return S.a.createElement("div",{className:"force-schedule-board"},S.a.createElement("div",{className:"student-select"},S.a.createElement("span",{className:"label"},"Sinh viên đang chọn"),S.a.createElement(Y.a,{options:r,value:n,displayAs:function(e){return e.name+" (".concat(e.identityID,")")},getValue:function(e){return e._id},onChange:function(t){e.setState({pickedStudent:r.find((function(e){return e._id===t.target.value})),loading:!0,pickedSubject:null},(function(){e.board.loadData(),e.loadData().then((function(t){return e.setState(V({},t,{loading:!1}))}))}))}})),S.a.createElement("div",{className:"content-wrapper-hehe"},S.a.createElement("div",{className:"subject-list"},c?S.a.createElement(j.a,null):S.a.createElement(S.a.Fragment,null,S.a.createElement("div",{className:"small-title"},"Danh sách môn đăng ký"),S.a.createElement(A.a,{pickedSubject:a,subjectList:i,schedule:this.state.schedule,subject:s,onRegister:this.onRegister,toggleRegister:this.toggleRegister,onChange:function(t){return e.setState({pickedSubject:t})}}))),S.a.createElement(D.a,{schoolYear:n.info.schoolYear,schedule:this.state.schedule,label:"Học phí kì này"}),S.a.createElement(L.a,{filter:{semester:I.a.find((function(e){return e.value===l})),year:x.a.find((function(e){return e.value===Object(R.d)(u)}))},ref:function(t){return e.board=t},className:"ins-schedule-board",api:function(){var t,r,a,i,c,s;return N.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:return t=C.a.syncGet(),r=t.currentYear,a=t.currentSemester,i={year:x.a.find((function(e){return e.value===Object(R.d)(r)})),semester:I.a.find((function(e){return e.value===a}))},c=i.year,s=i.semester,o.abrupt("return",P.a.getStudentSchedule(n.info._id,c.value,s.value).then((function(t){return e.setState({schedule:t}),t||{list:[]}})));case 3:case"end":return o.stop()}}))},displayItem:this.displayInsScheduleItem,onClickItem:this.onClickScheduleItem,getDayOfWeek:function(e){return e.dayOfWeek},getShiftStart:function(e){return e.from.name},getShiftEnd:function(e){return e.to.name},showSuggestion:!0})))}}]),t}(b.Component);function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}n.d(t,"default",(function(){return M}));var M=function(e){function t(e){var n;return a()(this,t),n=o()(this,l()(t).call(this,e)),h()(f()(n),"filterStudents",(function(e,t){return e.filter((function(e){return e.identityID.toLowerCase().includes(t.trim().toLowerCase())||e.name.toLowerCase().includes(t.trim().toLowerCase())}))})),h()(f()(n),"handleChangeStudents",(function(e){n.setState({pickedStudents:e})})),n.initData={pickedStudents:[],students:[],loadStudents:!0},n.state=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(Object(n),!0).forEach((function(t){h()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n.initData),E.a.getBriefStudents().then((function(e){return n.setState({students:e.filter((function(e){return e.identityID})),loadStudents:!1})})),n}return g()(t,e),c()(t,[{key:"render",value:function(){var e=this.state,t=e.students,n=e.loadStudents,r=e.pickedStudents;return S.a.createElement(v.a,{title:"Ép cứng"},S.a.createElement(k.a,{title:"Ép cứng môn học"},S.a.createElement("div",{className:"force-register-route"},S.a.createElement("div",{className:"common-route-wrapper"},n&&S.a.createElement(j.a,null),S.a.createElement("div",{className:"force-step"},S.a.createElement("div",{className:"step-title"},S.a.createElement("span",{className:"strong"},"Bước 1:"),"Chọn sinh viên ép cứng"),S.a.createElement("div",{className:"step-body"},S.a.createElement("div",{className:"select-wrapper"},S.a.createElement(O.a,{values:r,list:t,displayTagAs:function(e,t){return e.identityID},displayAs:function(e,t){return e.name+" (".concat(e.identityID,")")},filterFunc:this.filterStudents,onChange:this.handleChangeStudents,listKey:function(e){return e._id},tagKey:function(e){return e._id},emptyNotify:function(){return"Không tìm thấy sinh viên nào"},isPicked:function(e){return r.find((function(t){return t._id===e._id}))},deleteFilterFunc:function(e,t){return e._id!==t._id}})))),!!r.length&&S.a.createElement("div",{className:"force-step"},S.a.createElement("div",{className:"step-title"},S.a.createElement("span",{className:"strong"},"Bước 2:"),"Ép cứng cho ",S.a.createElement("span",{className:"hi-light"},r.length," "),"sinh viên"),S.a.createElement("div",{className:"step-body"},S.a.createElement(q,{pickedStudents:r})))))))}}]),t}(y.a)}}]);